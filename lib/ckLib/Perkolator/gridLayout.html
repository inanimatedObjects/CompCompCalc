<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <link rel="stylesheet" href="./style.css"></style>
</head>

<body>
  <script type="text/javascript" src="./data.js"></script>
  <script type="text/javascript" src="./scripts/renderCard.js"></script>
  <script type="text/javascript" src="./scripts/renderStackedBar.js"></script>


  <div class="grid">
    <div class="box head">
      <h2 class="title">perkolator</h2>
    </div>

    <div class="box stackedBar" id="stackedBar">


    </div>

    <form id="stackedBarPanel">
      <fieldset>
        <legend>Total Aggregate Compensations => { <abbr title="This stacked bar chart is driven by the summary compenensation terms from each of the different panels below. All values have been converted into dollar denominations in order to reduce everything to a single earnings figure.">base salary</abbr> }</legend>
        <label for="stackedBarPanel">
    
    <!-- TODO: look into html templates - use this as a modular piece if it works -->
    <div class="box card cash1">

      <div id="cardContainer">
        <div id="cash1" class="bar"></div>
        <div class="outputContainer">
          <output class="cash1 slider">$7,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="cash1 sliderRange sliderMin" disabled />
            <input type="range" value="0.7" max="1" step=".01" name="Signing Bonus" class="cash1 slider" />
            <input type="number" value="10000" name="sliderMax" class="cash1 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn cash1">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card cash2">
      <div id="cardContainer">
        <div id="cash2" class="bar"></div>
        <div class="outputContainer">
          <output class="cash2 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="cash2 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="Base Salary" class="cash2 slider" />
            <input type="number" value="100000" name="sliderMax" class="cash2 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn cash2">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card cash3">
      <div id="cardContainer">
        <div id="cash3" class="bar"></div>
        <div class="outputContainer">
          <output class="cash3 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="cash3 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="Incentive Comp - Cash" class="cash3 slider" />
            <input type="number" value="100000" name="sliderMax" class="cash3 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn cash3">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card equity1">
      <div id="cardContainer">
        <div id="equity1" class="bar"></div>
        <div class="outputContainer">
          <output class="equity1 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="equity1 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="Base Equity" class="equity1 slider" />
            <input type="number" value="100000" name="sliderMax" class="equity1 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn equity1">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card equity2">
      <div id="cardContainer">
        <div id="equity2" class="bar"></div>
        <div class="outputContainer">
          <output class="equity2 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="equity2 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="eqRate" class="equity2 slider" />
            <input type="number" value="100000" name="sliderMax" class="equity2 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn equity2">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card equity3">
      <div id="cardContainer">
        <div id="equity3" class="bar"></div>
        <div class="outputContainer">
          <output class="equity3 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="equity3 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="Incentive Comp - Equity" class="equity3 slider" />
            <input type="number" value="100000" name="sliderMax" class="equity3 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn equity3">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card perks1">
      <div id="cardContainer">
        <div id="perks1" class="bar"></div>
        <div class="outputContainer">
          <output class="perks1 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="perks1 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="Stipends" class="perks1 slider" />
            <input type="number" value="100000" name="sliderMax" class="perks1 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn perks1">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card perks2">
      <div id="cardContainer">
        <div id="perks2" class="bar"></div>
        <div class="outputContainer">
          <output class="perks2 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="perks2 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="Benefits" class="perks2 slider" />
            <input type="number" value="100000" name="sliderMax" class="perks2 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn perks2">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card perks3">
      <div id="cardContainer">
        <div id="perks3" class="bar"></div>
        <div class="outputContainer">
          <output class="perks3 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="perks3 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="Retirement Savings" class="perks3 slider" />
            <input type="number" value="100000" name="sliderMax" class="perks3 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn perks3">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card time1">
      <div id="cardContainer">
        <div id="time1" class="bar"></div>
        <div class="outputContainer">
          <output class="time1 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="time1 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="timeRate" class="time1 slider" />
            <input type="number" value="100000" name="sliderMax" class="time1 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn time1">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card time2">
      <div id="cardContainer">
        <div id="time2" class="bar"></div>
        <div class="outputContainer">
          <output class="time2 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="time2 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="timeAllocation" class="time2 slider" />
            <input type="number" value="100000" name="sliderMax" class="time2 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn time2">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box card time3">
      <div id="cardContainer">
        <div id="time3" class="bar"></div>
        <div class="outputContainer">
          <output class="time3 slider">$80,000</output>
        </div>
        <div id="sliderContainer">
          <p>
            <input type="number" value="0" name="sliderMin" class="time3 sliderRange sliderMin" disabled />
            <input type="range" value="0.8" max="1" step=".01" name="timeUtilization" class="time3 slider" />
            <input type="number" value="100000" name="sliderMax" class="time3 sliderRange sliderMax" disabled />
          </p>
          <button type="button" class="unlockBtn time3">Unlock range</button>
        </div>
      </div>
    </div>
    <div class="box footer">
      <div class="ioTag">
        <p>inanimated objects     </p> <p class="ioLine"> / </p> <p>       2018</p>
      </div>
    </div>
  </div>

  <script>
    const cardsArr = [
      'cash1', 'cash2', 'cash3',
      'equity1', 'equity2', 'equity3',
      'perks1', 'perks2', 'perks3',
      'time1', 'time2', 'time3'
    ]

    // define color scale
    var colorScale = d3.scaleOrdinal(d3.schemePaired);
    console.log(colorScale)

    // change button text, disable/enable input lock
    $('.unlockBtn').click(function() {
      this.innerHTML === 'Unlock range' ? this.innerHTML='Lock range'
                                  : this.innerHTML='Unlock range';
      let rangesArr = document.querySelectorAll('.sliderRange.' + this.classList[1]);
      rangesArr.forEach(function(range) {
        $(range).prop('disabled', (i, v) => { return !v });
        $(range).hasClass('unlocked') ? $(range).removeClass('unlocked')
                                    : $(range).addClass('unlocked');
      })
    });


    // render all cards
    cardsArr.forEach((card) => {
      renderCard(card);
    })

    var backBarWidth = 350;
    var currDisplayVals = document.querySelectorAll('output.slider');
    var displayValsArr = [];
    // change currDisplayVals from a node list to an array
    for (var i = currDisplayVals.length; i--; displayValsArr.unshift(currDisplayVals[i]));
    // create sanitized array of display values
    var dataArr = displayValsArr.map(function(d) {
      return Number(d.innerHTML.split(',').join('').split('$').join(''));
    });
    // create an accumulating x-scale
    var accumXScale = [0];
    dataArr.reduce((a, b, i) => {
      return accumXScale[i + 1] = a + b;
    }, 0);
    // store the total value of all cards
    var dataTotal = accumXScale[accumXScale.length - 1]
    console.log(dataArr)
    renderStackedBar(dataArr)

  </script>

</body>
